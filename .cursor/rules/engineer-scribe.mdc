---
description: Engineering traceability and scribe discipline — the full checklist for code changes, training runs, git tagging, WandB integration, and CHANGELOG updates. Apply after every architecture change or completed implementation.
alwaysApply: false
---

# Engineer-Scribe: Traceability and Documentation Discipline

Apply this discipline after every architectural change, training run, or implementation session. The goal is to keep three documents permanently linked so any future reader can trace code → experiment → result.

## The Three-Document Traceability Model

```
CHANGELOG.md  (code changes)
    ↕ git tag
master_experiment_log.md  (training runs)
    ↕ run_id
docs/2_Experiments_Registry/run_reports/  (detailed analysis)
         ↑
active_todos.md  (tasks → completion dates → implementation → CHANGELOG)
```

Every WandB run config must include `git_commit` and `git_tag` so the live metrics link back to the exact code version.

## After Every Architectural Change — Checklist

1. **Update `CHANGELOG.md`** (repo root) with a dated entry:
   - What changed (file names, class names, new arguments)
   - Why it was changed (hypothesis, bug, performance motivation)
   - Format: `## [YYYY-MM-DD] — <short title>`
2. **Create a git tag** using the `arch/` convention (see below) before starting any training run based on that code.
3. **Update `docs/1_Strategy_and_Plans/active_todos.md`** — mark completed tasks with the completion date and the git commit hash.
4. **Verify `get_git_info()`** is called in the training script and the result is passed to `wandb.init(config=...)`.

## Before a Training Run — Checklist

1. **Tag the repository**: `git tag train/{run_id}_{YYYYMMDD}` and push tags.
2. **Confirm** the training script includes `git_commit` + `git_tag` in the WandB config.
3. **Add a pending row** to `master_experiment_log.md` with the tag, architecture, and hyperparameters (fill in results after the run).

## After a Training Run — Checklist

1. **Update `master_experiment_log.md`** — fill in: eval scores, WandB link, `git_tag`, hardware, final loss.
2. **Write a run report** in `docs/2_Experiments_Registry/run_reports/` if the run reveals anything non-obvious (anomalies, collapse, unexpected gains).
3. **Sync evaluation reports** from remote servers: `.\scripts\sync_evaluation_reports.ps1`
4. **Update `active_todos.md`** — close any tasks that were resolved by this run's findings.

## Git Commit Message Conventions

Use these prefixes to make the git log machine-parseable and self-documenting:

| Prefix | Use for |
|---|---|
| `arch:` | New model architecture or significant structural change |
| `train:` | Training script changes (hyperparams, data pipeline) |
| `eval:` | Evaluation script or benchmark changes |
| `fix:` | Bug fixes |
| `docs:` | Documentation updates (CHANGELOG, experiment log, rules) |
| `feat:` | New feature (loss function, metric, utility) |
| `test:` | Unit test additions or fixes |

**Examples:**
```
arch: add recursive concept encoder with weight-tied cross-attention (K=3)
train: increase batch size to 128, add gradient clipping
eval: add SICK-Relatedness and PAWS benchmarks
docs: update CHANGELOG and experiment log for run perceiver_mlm_H512L6C128
feat: add VICRegLoss and KendallGalWeighting to loss_manager
fix: correct concept mask shape mismatch in perceiver decoder
```

## Git Tag Conventions

| Pattern | When to use |
|---|---|
| `arch/{feature}` | After merging a new architecture (e.g. `arch/recursive-encoder`) |
| `train/{run_id}_{date}` | Immediately before starting a training run |
| `eval/{benchmark}_{date}` | Before a major evaluation sweep |

Push tags explicitly: `git push origin --tags`

## WandB Integration

All training scripts must call `get_git_info()` from `training/utils_training.py` and include its output in the `wandb.init()` config:

```python
from training.utils_training import get_git_info

git_info = get_git_info()
wandb.init(
    project="MrCogito",
    config={
        # ... hyperparams ...
        "git_commit": git_info["commit"],
        "git_tag": git_info["tag"],
        "git_branch": git_info["branch"],
    }
)
```

## CHANGELOG.md Format

Follow "Keep a Changelog" (https://keepachangelog.com) conventions:

```markdown
## [YYYY-MM-DD] — Short Title

**What changed:**
- `nn/concept_encoder_recursive.py`: added weight-tied cross-attention with K iterations
- `training/mlm_training.py`: added `--num_recursive_steps` argument

**Why:**
- TRM paper shows recursive refinement improves concept quality without extra params
- Enables test-time compute scaling

**Git tag:** `arch/recursive-encoder`
**Related TODO:** `active_todos.md` → "Implement recursive concept encoder" (completed)
```
